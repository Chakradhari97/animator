'use strict';

var _jsxFileName = 'src/react/index.js';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

var _Websocket = require('haiku-serialization/src/ws/Websocket');

var _Websocket2 = _interopRequireDefault(_Websocket);

var _Glass = require('./Glass');

var _Glass2 = _interopRequireDefault(_Glass);

var _carbonite = require('haiku-serialization/src/utils/carbonite');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

if (process.env.HAIKU_RELEASE_ENVIRONMENT === 'production' || process.env.HAIKU_RELEASE_ENVIRONMENT === 'staging') {
  window.Raven.config('https://287e52df9cfd48aab7f6091ec17a5921@sentry.io/226362', {
    environment: process.env.HAIKU_RELEASE_ENVIRONMENT || 'development',
    release: process.env.HAIKU_RELEASE_VERSION,
    dataCallback: _carbonite.sentryCallback
  }).install();
  window.Raven.context(function () {
    go();
  });
} else {
  go();
}

function go() {
  // We are in a webview; use query string parameters for boot-up configuration
  var search = (window.location.search || '').split('?')[1] || '';
  var params = _qs2.default.parse(search, { plainObjects: true });
  var config = _lodash2.default.assign({}, params);
  if (!config.folder) throw new Error('A folder (the absolute path to the user project) is required');
  function _fixPlumbingUrl(url) {
    return url.replace(/^http/, 'ws');
  }

  var userconfig = require(_path2.default.join(config.folder, 'haiku.js'));

  var websocket = config.plumbing ? new _Websocket2.default(_fixPlumbingUrl(config.plumbing), config.folder, 'controllee', 'glass') : { on: function on() {}, send: function send() {}, method: function method() {}, request: function request() {}, action: function action() {}

    // Add extra context to Sentry reports, this info is also used
    // by carbonite.
  };var folderHelper = config.folder.split('/').reverse();
  window.Raven.setExtraContext({
    organizationName: folderHelper[1],
    projectName: folderHelper[0]
  });

  _reactDom2.default.render(_react2.default.createElement(_Glass2.default, {
    envoy: config.envoy,
    userconfig: userconfig,
    websocket: websocket,
    folder: config.folder,
    projectName: userconfig.name || 'untitled',
    __source: {
      fileName: _jsxFileName,
      lineNumber: 46
    },
    __self: this
  }), document.getElementById('root'));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZWFjdC9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCIsIndpbmRvdyIsIlJhdmVuIiwiY29uZmlnIiwiZW52aXJvbm1lbnQiLCJyZWxlYXNlIiwiSEFJS1VfUkVMRUFTRV9WRVJTSU9OIiwiZGF0YUNhbGxiYWNrIiwiaW5zdGFsbCIsImNvbnRleHQiLCJnbyIsInNlYXJjaCIsImxvY2F0aW9uIiwic3BsaXQiLCJwYXJhbXMiLCJwYXJzZSIsInBsYWluT2JqZWN0cyIsImFzc2lnbiIsImZvbGRlciIsIkVycm9yIiwiX2ZpeFBsdW1iaW5nVXJsIiwidXJsIiwicmVwbGFjZSIsInVzZXJjb25maWciLCJyZXF1aXJlIiwiam9pbiIsIndlYnNvY2tldCIsInBsdW1iaW5nIiwib24iLCJzZW5kIiwibWV0aG9kIiwicmVxdWVzdCIsImFjdGlvbiIsImZvbGRlckhlbHBlciIsInJldmVyc2UiLCJzZXRFeHRyYUNvbnRleHQiLCJvcmdhbml6YXRpb25OYW1lIiwicHJvamVjdE5hbWUiLCJyZW5kZXIiLCJlbnZveSIsIm5hbWUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBLElBQUlBLFFBQVFDLEdBQVIsQ0FBWUMseUJBQVosS0FBMEMsWUFBMUMsSUFBMERGLFFBQVFDLEdBQVIsQ0FBWUMseUJBQVosS0FBMEMsU0FBeEcsRUFBbUg7QUFDakhDLFNBQU9DLEtBQVAsQ0FBYUMsTUFBYixDQUFvQiwyREFBcEIsRUFBaUY7QUFDL0VDLGlCQUFhTixRQUFRQyxHQUFSLENBQVlDLHlCQUFaLElBQXlDLGFBRHlCO0FBRS9FSyxhQUFTUCxRQUFRQyxHQUFSLENBQVlPLHFCQUYwRDtBQUcvRUM7QUFIK0UsR0FBakYsRUFJR0MsT0FKSDtBQUtBUCxTQUFPQyxLQUFQLENBQWFPLE9BQWIsQ0FBcUIsWUFBWTtBQUMvQkM7QUFDRCxHQUZEO0FBR0QsQ0FURCxNQVNPO0FBQ0xBO0FBQ0Q7O0FBRUQsU0FBU0EsRUFBVCxHQUFlO0FBQ2I7QUFDQSxNQUFNQyxTQUFTLENBQUNWLE9BQU9XLFFBQVAsQ0FBZ0JELE1BQWhCLElBQTBCLEVBQTNCLEVBQStCRSxLQUEvQixDQUFxQyxHQUFyQyxFQUEwQyxDQUExQyxLQUFnRCxFQUEvRDtBQUNBLE1BQU1DLFNBQVMsYUFBR0MsS0FBSCxDQUFTSixNQUFULEVBQWlCLEVBQUVLLGNBQWMsSUFBaEIsRUFBakIsQ0FBZjtBQUNBLE1BQU1iLFNBQVMsaUJBQU9jLE1BQVAsQ0FBYyxFQUFkLEVBQWtCSCxNQUFsQixDQUFmO0FBQ0EsTUFBSSxDQUFDWCxPQUFPZSxNQUFaLEVBQW9CLE1BQU0sSUFBSUMsS0FBSixDQUFVLDhEQUFWLENBQU47QUFDcEIsV0FBU0MsZUFBVCxDQUEwQkMsR0FBMUIsRUFBK0I7QUFBRSxXQUFPQSxJQUFJQyxPQUFKLENBQVksT0FBWixFQUFxQixJQUFyQixDQUFQO0FBQW1DOztBQUVwRSxNQUFNQyxhQUFhQyxRQUFRLGVBQUtDLElBQUwsQ0FBVXRCLE9BQU9lLE1BQWpCLEVBQXlCLFVBQXpCLENBQVIsQ0FBbkI7O0FBRUEsTUFBTVEsWUFBYXZCLE9BQU93QixRQUFSLEdBQ2Qsd0JBQWNQLGdCQUFnQmpCLE9BQU93QixRQUF2QixDQUFkLEVBQWdEeEIsT0FBT2UsTUFBdkQsRUFBK0QsWUFBL0QsRUFBNkUsT0FBN0UsQ0FEYyxHQUVkLEVBQUVVLElBQUksY0FBTSxDQUFFLENBQWQsRUFBZ0JDLE1BQU0sZ0JBQU0sQ0FBRSxDQUE5QixFQUFnQ0MsUUFBUSxrQkFBTSxDQUFFLENBQWhELEVBQWtEQyxTQUFTLG1CQUFNLENBQUUsQ0FBbkUsRUFBcUVDLFFBQVEsa0JBQU0sQ0FBRTs7QUFFekY7QUFDQTtBQUhJLEdBRkosQ0FNQSxJQUFNQyxlQUFlOUIsT0FBT2UsTUFBUCxDQUFjTCxLQUFkLENBQW9CLEdBQXBCLEVBQXlCcUIsT0FBekIsRUFBckI7QUFDQWpDLFNBQU9DLEtBQVAsQ0FBYWlDLGVBQWIsQ0FBNkI7QUFDM0JDLHNCQUFrQkgsYUFBYSxDQUFiLENBRFM7QUFFM0JJLGlCQUFhSixhQUFhLENBQWI7QUFGYyxHQUE3Qjs7QUFLQSxxQkFBU0ssTUFBVCxDQUNFO0FBQ0UsV0FBT25DLE9BQU9vQyxLQURoQjtBQUVFLGdCQUFZaEIsVUFGZDtBQUdFLGVBQVdHLFNBSGI7QUFJRSxZQUFRdkIsT0FBT2UsTUFKakI7QUFLRSxpQkFBYUssV0FBV2lCLElBQVgsSUFBbUIsVUFMbEM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFERixFQVFFQyxTQUFTQyxjQUFULENBQXdCLE1BQXhCLENBUkY7QUFVRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nXG5pbXBvcnQgbG9kYXNoIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgcXMgZnJvbSAncXMnXG5pbXBvcnQgV2Vic29ja2V0IGZyb20gJ2hhaWt1LXNlcmlhbGl6YXRpb24vc3JjL3dzL1dlYnNvY2tldCdcbmltcG9ydCBHbGFzcyBmcm9tICcuL0dsYXNzJ1xuaW1wb3J0IHtzZW50cnlDYWxsYmFja30gZnJvbSAnaGFpa3Utc2VyaWFsaXphdGlvbi9zcmMvdXRpbHMvY2FyYm9uaXRlJ1xuXG5pZiAocHJvY2Vzcy5lbnYuSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCA9PT0gJ3Byb2R1Y3Rpb24nIHx8IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgPT09ICdzdGFnaW5nJykge1xuICB3aW5kb3cuUmF2ZW4uY29uZmlnKCdodHRwczovLzI4N2U1MmRmOWNmZDQ4YWFiN2Y2MDkxZWMxN2E1OTIxQHNlbnRyeS5pby8yMjYzNjInLCB7XG4gICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgfHwgJ2RldmVsb3BtZW50JyxcbiAgICByZWxlYXNlOiBwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX1ZFUlNJT04sXG4gICAgZGF0YUNhbGxiYWNrOiBzZW50cnlDYWxsYmFja1xuICB9KS5pbnN0YWxsKClcbiAgd2luZG93LlJhdmVuLmNvbnRleHQoZnVuY3Rpb24gKCkge1xuICAgIGdvKClcbiAgfSlcbn0gZWxzZSB7XG4gIGdvKClcbn1cblxuZnVuY3Rpb24gZ28gKCkge1xuICAvLyBXZSBhcmUgaW4gYSB3ZWJ2aWV3OyB1c2UgcXVlcnkgc3RyaW5nIHBhcmFtZXRlcnMgZm9yIGJvb3QtdXAgY29uZmlndXJhdGlvblxuICBjb25zdCBzZWFyY2ggPSAod2luZG93LmxvY2F0aW9uLnNlYXJjaCB8fCAnJykuc3BsaXQoJz8nKVsxXSB8fCAnJ1xuICBjb25zdCBwYXJhbXMgPSBxcy5wYXJzZShzZWFyY2gsIHsgcGxhaW5PYmplY3RzOiB0cnVlIH0pXG4gIGNvbnN0IGNvbmZpZyA9IGxvZGFzaC5hc3NpZ24oe30sIHBhcmFtcylcbiAgaWYgKCFjb25maWcuZm9sZGVyKSB0aHJvdyBuZXcgRXJyb3IoJ0EgZm9sZGVyICh0aGUgYWJzb2x1dGUgcGF0aCB0byB0aGUgdXNlciBwcm9qZWN0KSBpcyByZXF1aXJlZCcpXG4gIGZ1bmN0aW9uIF9maXhQbHVtYmluZ1VybCAodXJsKSB7IHJldHVybiB1cmwucmVwbGFjZSgvXmh0dHAvLCAnd3MnKSB9XG5cbiAgY29uc3QgdXNlcmNvbmZpZyA9IHJlcXVpcmUocGF0aC5qb2luKGNvbmZpZy5mb2xkZXIsICdoYWlrdS5qcycpKVxuXG4gIGNvbnN0IHdlYnNvY2tldCA9IChjb25maWcucGx1bWJpbmcpXG4gICAgPyBuZXcgV2Vic29ja2V0KF9maXhQbHVtYmluZ1VybChjb25maWcucGx1bWJpbmcpLCBjb25maWcuZm9sZGVyLCAnY29udHJvbGxlZScsICdnbGFzcycpXG4gICAgOiB7IG9uOiAoKSA9PiB7fSwgc2VuZDogKCkgPT4ge30sIG1ldGhvZDogKCkgPT4ge30sIHJlcXVlc3Q6ICgpID0+IHt9LCBhY3Rpb246ICgpID0+IHt9IH1cblxuICAvLyBBZGQgZXh0cmEgY29udGV4dCB0byBTZW50cnkgcmVwb3J0cywgdGhpcyBpbmZvIGlzIGFsc28gdXNlZFxuICAvLyBieSBjYXJib25pdGUuXG4gIGNvbnN0IGZvbGRlckhlbHBlciA9IGNvbmZpZy5mb2xkZXIuc3BsaXQoJy8nKS5yZXZlcnNlKClcbiAgd2luZG93LlJhdmVuLnNldEV4dHJhQ29udGV4dCh7XG4gICAgb3JnYW5pemF0aW9uTmFtZTogZm9sZGVySGVscGVyWzFdLFxuICAgIHByb2plY3ROYW1lOiBmb2xkZXJIZWxwZXJbMF1cbiAgfSlcblxuICBSZWFjdERPTS5yZW5kZXIoXG4gICAgPEdsYXNzXG4gICAgICBlbnZveT17Y29uZmlnLmVudm95fVxuICAgICAgdXNlcmNvbmZpZz17dXNlcmNvbmZpZ31cbiAgICAgIHdlYnNvY2tldD17d2Vic29ja2V0fVxuICAgICAgZm9sZGVyPXtjb25maWcuZm9sZGVyfVxuICAgICAgcHJvamVjdE5hbWU9e3VzZXJjb25maWcubmFtZSB8fCAndW50aXRsZWQnfVxuICAgICAgLz4sXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKVxuICApXG59XG4iXX0=