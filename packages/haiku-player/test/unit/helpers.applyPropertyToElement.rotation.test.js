var test = require('tape')
var applyPropertyToElement = require('./../../lib/helpers/applyPropertyToElement').default

test('helpers.applyPropertyToElement.rotation', function (t) {
  var element = {
    "elementName": "svg",
    "attributes": {"version":"1.1","xmlns":"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","source":"designs/comet.sketch.contents/slices/Group.svg","haiku-title":"Group","haiku-id":"364b522f7643","style":{"position":"absolute","margin":"0","padding":"0","border":"0","zIndex":1},"viewBox":"0 0 322 192"},
    "children": [],
    "layout": {
      "shown":true,
      "opacity":1,
      "mount":{"x":0,"y":0,"z":0},
      "align":{"x":0,"y":0,"z":0},
      "origin":{"x":0,"y":0,"z":0},
      "translation":{"x":123,"y":95,"z":0},
      "rotation":{"x":0,"y":0,"z":0,"w":0},
      "scale":{"x":1,"y":1,"z":1},
      "sizeMode":{"x":1,"y":1,"z":0},
      "sizeProportional":{"x":1,"y":1,"z":1},
      "sizeDifferential":{"x":0,"y":0,"z":0},
      "sizeAbsolute":{"x":322,"y":192,"z":0},
      "matrix":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]
    }
  }

  var seq = [
    // Initial application
    ["style.position","absolute",{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["style.margin","0",{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["style.padding","0",{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["style.border","0",{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["sizeAbsolute.x",322,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["sizeMode.x",1,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["sizeAbsolute.y",192,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["sizeMode.y",1,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["translation.x",123,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["translation.y",95,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["style.zIndex",1,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":0}],
    ["rotation.x",0,{"x":0,"y":0,"z":0,"w":0},{"x":0,"y":0,"z":0,"w":1}],
    ["rotation.y",1,{"x":0,"y":0,"z":0,"w":1},{"x":0,"y":0.479425538604203,"z":0,"w":0.8775825618903728}],
    ["rotation.z",3.6049668520397353,{"x":0,"y":0.479425538604203,"z":0,"w":0.8775825618903728},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["style.position","absolute",{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["style.margin","0",{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["style.padding","0",{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["style.border","0",{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["sizeAbsolute.x",322,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["sizeMode.x",1,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["sizeAbsolute.y",192,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["sizeMode.y",1,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["translation.x",123,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["translation.y",95,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["style.zIndex",1,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724}],
    ["rotation.x",0,{"x":0.2310797517663407,"y":-0.05451718045515592,"z":0.945450614027618,"w":-0.22305416784634724},{"x":-0.01240969166461269,"y":-0.024266155044725235,"z":0.455145251997164,"w":0.8899999735149281}],
    ["rotation.y",1,{"x":-0.01240969166461269,"y":-0.024266155044725235,"z":0.455145251997164,"w":0.8899999735149281},{"x":0.10285790973407911,"y":0.4682839938576748,"z":0.1950925312695068,"w":0.8556104579449095}],
    ["rotation.z",3.6049668520397353,{"x":0.10285790973407911,"y":0.4682839938576748,"z":0.1950925312695068,"w":0.8556104579449095},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    // Rotation on stage
    ["style.position","absolute",{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["style.margin","0",{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["style.padding","0",{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["style.border","0",{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["sizeAbsolute.x",322,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["sizeMode.x",1,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["sizeAbsolute.y",192,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["sizeMode.y",1,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["translation.x",123,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["translation.y",95,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["style.zIndex",1,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991}],
    ["rotation.x",0,{"x":0.21402892257104916,"y":-0.10187084548405753,"z":0.9427328878471548,"w":-0.23466711170251991},{"x":-0.0231199861777314,"y":-0.045361223947515135,"z":0.453515199792095,"w":0.8897931159312602}],
    ["rotation.y",1,{"x":-0.0231199861777314,"y":-0.045361223947515135,"z":0.453515199792095,"w":0.8897931159312602},{"x":0.09789199448408983,"y":0.46940196390895356,"z":0.19188416845070672,"w":0.8563056811631727}],
    ["rotation.z",3.6075780554713828,{"x":0.09789199448408983,"y":0.46940196390895356,"z":0.19188416845070672,"w":0.8563056811631727},{"x":0.21501064018422505,"y":-0.09992908240174456,"z":0.9425441084096561,"w":-0.23536186352117783}],
    // This secondary rotation causes a problem creating bad rotation values
    ["rotation.z",3.6075780554713828,{"x":0.21501064018422505,"y":-0.09992908240174456,"z":0.9425441084096561,"w":-0.23536186352117783},{"x":-0.0730569644879861,"y":-0.09280388611454148,"z":0.9673927021203869,"w":-0.2240568645367889}],
  ]

  t.plan(seq.length * 2)

  seq.forEach(([ name, value, before, after ], index) => {
    t.equal(JSON.stringify(element.layout.rotation), JSON.stringify(before))
    applyPropertyToElement(element, name, value, {}, {})
    t.equal(JSON.stringify(element.layout.rotation), JSON.stringify(after))
  })
})
