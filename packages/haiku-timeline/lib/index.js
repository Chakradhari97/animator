'use strict';

var _jsxFileName = 'src/index.js';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

var _Websocket = require('haiku-serialization/src/ws/Websocket');

var _Websocket2 = _interopRequireDefault(_Websocket);

var _Timeline = require('./components/Timeline');

var _Timeline2 = _interopRequireDefault(_Timeline);

var _carbonite = require('haiku-serialization/src/utils/carbonite');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

if (process.env.HAIKU_RELEASE_ENVIRONMENT === 'production' || process.env.HAIKU_RELEASE_ENVIRONMENT === 'staging') {
  window.Raven.config('https://d045653ab5d44c808480fa6c3fa8e87c@sentry.io/226387', {
    environment: process.env.HAIKU_RELEASE_ENVIRONMENT || 'development',
    release: process.env.HAIKU_RELEASE_VERSION,
    dataCallback: _carbonite.sentryCallback
  }).install();
  window.Raven.context(function () {
    go();
  });
} else {
  go();
}

function go() {
  // We are in a webview; use query string parameters for boot-up configuration
  var search = (window.location.search || '').split('?')[1] || '';
  var params = _qs2.default.parse(search, { plainObjects: true });
  var config = _lodash2.default.assign({}, params);
  if (!config.folder) throw new Error('A folder (the absolute path to the user project) is required');
  function _fixPlumbingUrl(url) {
    return url.replace(/^http/, 'ws');
  }

  var userconfig = require(_path2.default.join(config.folder, 'haiku.js'));

  var websocket = config.plumbing ? new _Websocket2.default(_fixPlumbingUrl(config.plumbing), config.folder, 'controllee', 'timeline') : { on: function on() {}, send: function send() {}, method: function method() {}, request: function request() {}, sendIfConnected: function sendIfConnected() {}, action: function action() {}

    // Add extra context to Sentry reports, this info is also used
    // by carbonite.
  };var folderHelper = config.folder.split('/').reverse();
  window.Raven.setExtraContext({
    organizationName: folderHelper[1],
    projectName: folderHelper[0]
  });

  _reactDom2.default.render(_react2.default.createElement(_Timeline2.default, {
    envoy: config.envoy,
    userconfig: userconfig,
    websocket: websocket,
    folder: config.folder,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 46
    },
    __self: this
  }), document.getElementById('root'));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCIsIndpbmRvdyIsIlJhdmVuIiwiY29uZmlnIiwiZW52aXJvbm1lbnQiLCJyZWxlYXNlIiwiSEFJS1VfUkVMRUFTRV9WRVJTSU9OIiwiZGF0YUNhbGxiYWNrIiwiaW5zdGFsbCIsImNvbnRleHQiLCJnbyIsInNlYXJjaCIsImxvY2F0aW9uIiwic3BsaXQiLCJwYXJhbXMiLCJwYXJzZSIsInBsYWluT2JqZWN0cyIsImFzc2lnbiIsImZvbGRlciIsIkVycm9yIiwiX2ZpeFBsdW1iaW5nVXJsIiwidXJsIiwicmVwbGFjZSIsInVzZXJjb25maWciLCJyZXF1aXJlIiwiam9pbiIsIndlYnNvY2tldCIsInBsdW1iaW5nIiwib24iLCJzZW5kIiwibWV0aG9kIiwicmVxdWVzdCIsInNlbmRJZkNvbm5lY3RlZCIsImFjdGlvbiIsImZvbGRlckhlbHBlciIsInJldmVyc2UiLCJzZXRFeHRyYUNvbnRleHQiLCJvcmdhbml6YXRpb25OYW1lIiwicHJvamVjdE5hbWUiLCJyZW5kZXIiLCJlbnZveSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUEsSUFBSUEsUUFBUUMsR0FBUixDQUFZQyx5QkFBWixLQUEwQyxZQUExQyxJQUEwREYsUUFBUUMsR0FBUixDQUFZQyx5QkFBWixLQUEwQyxTQUF4RyxFQUFtSDtBQUNqSEMsU0FBT0MsS0FBUCxDQUFhQyxNQUFiLENBQW9CLDJEQUFwQixFQUFpRjtBQUMvRUMsaUJBQWFOLFFBQVFDLEdBQVIsQ0FBWUMseUJBQVosSUFBeUMsYUFEeUI7QUFFL0VLLGFBQVNQLFFBQVFDLEdBQVIsQ0FBWU8scUJBRjBEO0FBRy9FQztBQUgrRSxHQUFqRixFQUlHQyxPQUpIO0FBS0FQLFNBQU9DLEtBQVAsQ0FBYU8sT0FBYixDQUFxQixZQUFZO0FBQy9CQztBQUNELEdBRkQ7QUFHRCxDQVRELE1BU087QUFDTEE7QUFDRDs7QUFFRCxTQUFTQSxFQUFULEdBQWU7QUFDYjtBQUNBLE1BQU1DLFNBQVMsQ0FBQ1YsT0FBT1csUUFBUCxDQUFnQkQsTUFBaEIsSUFBMEIsRUFBM0IsRUFBK0JFLEtBQS9CLENBQXFDLEdBQXJDLEVBQTBDLENBQTFDLEtBQWdELEVBQS9EO0FBQ0EsTUFBTUMsU0FBUyxhQUFHQyxLQUFILENBQVNKLE1BQVQsRUFBaUIsRUFBRUssY0FBYyxJQUFoQixFQUFqQixDQUFmO0FBQ0EsTUFBTWIsU0FBUyxpQkFBT2MsTUFBUCxDQUFjLEVBQWQsRUFBa0JILE1BQWxCLENBQWY7QUFDQSxNQUFJLENBQUNYLE9BQU9lLE1BQVosRUFBb0IsTUFBTSxJQUFJQyxLQUFKLENBQVUsOERBQVYsQ0FBTjtBQUNwQixXQUFTQyxlQUFULENBQTBCQyxHQUExQixFQUErQjtBQUFFLFdBQU9BLElBQUlDLE9BQUosQ0FBWSxPQUFaLEVBQXFCLElBQXJCLENBQVA7QUFBbUM7O0FBRXBFLE1BQU1DLGFBQWFDLFFBQVEsZUFBS0MsSUFBTCxDQUFVdEIsT0FBT2UsTUFBakIsRUFBeUIsVUFBekIsQ0FBUixDQUFuQjs7QUFFQSxNQUFNUSxZQUFhdkIsT0FBT3dCLFFBQVIsR0FDZCx3QkFBY1AsZ0JBQWdCakIsT0FBT3dCLFFBQXZCLENBQWQsRUFBZ0R4QixPQUFPZSxNQUF2RCxFQUErRCxZQUEvRCxFQUE2RSxVQUE3RSxDQURjLEdBRWQsRUFBRVUsSUFBSSxjQUFNLENBQUUsQ0FBZCxFQUFnQkMsTUFBTSxnQkFBTSxDQUFFLENBQTlCLEVBQWdDQyxRQUFRLGtCQUFNLENBQUUsQ0FBaEQsRUFBa0RDLFNBQVMsbUJBQU0sQ0FBRSxDQUFuRSxFQUFxRUMsaUJBQWlCLDJCQUFNLENBQUUsQ0FBOUYsRUFBZ0dDLFFBQVEsa0JBQU0sQ0FBRTs7QUFFcEg7QUFDQTtBQUhJLEdBRkosQ0FNQSxJQUFNQyxlQUFlL0IsT0FBT2UsTUFBUCxDQUFjTCxLQUFkLENBQW9CLEdBQXBCLEVBQXlCc0IsT0FBekIsRUFBckI7QUFDQWxDLFNBQU9DLEtBQVAsQ0FBYWtDLGVBQWIsQ0FBNkI7QUFDM0JDLHNCQUFrQkgsYUFBYSxDQUFiLENBRFM7QUFFM0JJLGlCQUFhSixhQUFhLENBQWI7QUFGYyxHQUE3Qjs7QUFLQSxxQkFBU0ssTUFBVCxDQUNFO0FBQ0UsV0FBT3BDLE9BQU9xQyxLQURoQjtBQUVFLGdCQUFZakIsVUFGZDtBQUdFLGVBQVdHLFNBSGI7QUFJRSxZQUFRdkIsT0FBT2UsTUFKakI7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFERixFQU9FdUIsU0FBU0MsY0FBVCxDQUF3QixNQUF4QixDQVBGO0FBU0QiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IGxvZGFzaCBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHFzIGZyb20gJ3FzJ1xuaW1wb3J0IFdlYnNvY2tldCBmcm9tICdoYWlrdS1zZXJpYWxpemF0aW9uL3NyYy93cy9XZWJzb2NrZXQnXG5pbXBvcnQgVGltZWxpbmUgZnJvbSAnLi9jb21wb25lbnRzL1RpbWVsaW5lJ1xuaW1wb3J0IHtzZW50cnlDYWxsYmFja30gZnJvbSAnaGFpa3Utc2VyaWFsaXphdGlvbi9zcmMvdXRpbHMvY2FyYm9uaXRlJ1xuXG5pZiAocHJvY2Vzcy5lbnYuSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCA9PT0gJ3Byb2R1Y3Rpb24nIHx8IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgPT09ICdzdGFnaW5nJykge1xuICB3aW5kb3cuUmF2ZW4uY29uZmlnKCdodHRwczovL2QwNDU2NTNhYjVkNDRjODA4NDgwZmE2YzNmYThlODdjQHNlbnRyeS5pby8yMjYzODcnLCB7XG4gICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgfHwgJ2RldmVsb3BtZW50JyxcbiAgICByZWxlYXNlOiBwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX1ZFUlNJT04sXG4gICAgZGF0YUNhbGxiYWNrOiBzZW50cnlDYWxsYmFja1xuICB9KS5pbnN0YWxsKClcbiAgd2luZG93LlJhdmVuLmNvbnRleHQoZnVuY3Rpb24gKCkge1xuICAgIGdvKClcbiAgfSlcbn0gZWxzZSB7XG4gIGdvKClcbn1cblxuZnVuY3Rpb24gZ28gKCkge1xuICAvLyBXZSBhcmUgaW4gYSB3ZWJ2aWV3OyB1c2UgcXVlcnkgc3RyaW5nIHBhcmFtZXRlcnMgZm9yIGJvb3QtdXAgY29uZmlndXJhdGlvblxuICBjb25zdCBzZWFyY2ggPSAod2luZG93LmxvY2F0aW9uLnNlYXJjaCB8fCAnJykuc3BsaXQoJz8nKVsxXSB8fCAnJ1xuICBjb25zdCBwYXJhbXMgPSBxcy5wYXJzZShzZWFyY2gsIHsgcGxhaW5PYmplY3RzOiB0cnVlIH0pXG4gIGNvbnN0IGNvbmZpZyA9IGxvZGFzaC5hc3NpZ24oe30sIHBhcmFtcylcbiAgaWYgKCFjb25maWcuZm9sZGVyKSB0aHJvdyBuZXcgRXJyb3IoJ0EgZm9sZGVyICh0aGUgYWJzb2x1dGUgcGF0aCB0byB0aGUgdXNlciBwcm9qZWN0KSBpcyByZXF1aXJlZCcpXG4gIGZ1bmN0aW9uIF9maXhQbHVtYmluZ1VybCAodXJsKSB7IHJldHVybiB1cmwucmVwbGFjZSgvXmh0dHAvLCAnd3MnKSB9XG5cbiAgY29uc3QgdXNlcmNvbmZpZyA9IHJlcXVpcmUocGF0aC5qb2luKGNvbmZpZy5mb2xkZXIsICdoYWlrdS5qcycpKVxuXG4gIGNvbnN0IHdlYnNvY2tldCA9IChjb25maWcucGx1bWJpbmcpXG4gICAgPyBuZXcgV2Vic29ja2V0KF9maXhQbHVtYmluZ1VybChjb25maWcucGx1bWJpbmcpLCBjb25maWcuZm9sZGVyLCAnY29udHJvbGxlZScsICd0aW1lbGluZScpXG4gICAgOiB7IG9uOiAoKSA9PiB7fSwgc2VuZDogKCkgPT4ge30sIG1ldGhvZDogKCkgPT4ge30sIHJlcXVlc3Q6ICgpID0+IHt9LCBzZW5kSWZDb25uZWN0ZWQ6ICgpID0+IHt9LCBhY3Rpb246ICgpID0+IHt9IH1cblxuICAvLyBBZGQgZXh0cmEgY29udGV4dCB0byBTZW50cnkgcmVwb3J0cywgdGhpcyBpbmZvIGlzIGFsc28gdXNlZFxuICAvLyBieSBjYXJib25pdGUuXG4gIGNvbnN0IGZvbGRlckhlbHBlciA9IGNvbmZpZy5mb2xkZXIuc3BsaXQoJy8nKS5yZXZlcnNlKClcbiAgd2luZG93LlJhdmVuLnNldEV4dHJhQ29udGV4dCh7XG4gICAgb3JnYW5pemF0aW9uTmFtZTogZm9sZGVySGVscGVyWzFdLFxuICAgIHByb2plY3ROYW1lOiBmb2xkZXJIZWxwZXJbMF1cbiAgfSlcblxuICBSZWFjdERPTS5yZW5kZXIoXG4gICAgPFRpbWVsaW5lXG4gICAgICBlbnZveT17Y29uZmlnLmVudm95fVxuICAgICAgdXNlcmNvbmZpZz17dXNlcmNvbmZpZ31cbiAgICAgIHdlYnNvY2tldD17d2Vic29ja2V0fVxuICAgICAgZm9sZGVyPXtjb25maWcuZm9sZGVyfVxuICAgICAgLz4sXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKVxuICApXG59XG4iXX0=