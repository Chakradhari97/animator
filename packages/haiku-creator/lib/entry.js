'use strict';

var _carbonite = require('haiku-serialization/src/utils/carbonite');

(function () {
  if (process.env.HAIKU_RELEASE_ENVIRONMENT === 'production' || process.env.HAIKU_RELEASE_ENVIRONMENT === 'staging') {
    window.Raven.config('https://07b703c10ea14681a29a1a870c28e84a@sentry.io/226383', {
      environment: process.env.HAIKU_RELEASE_ENVIRONMENT || 'development',
      release: process.env.HAIKU_RELEASE_VERSION,
      dataCallback: _carbonite.sentryCallback
    }).install();
    window.Raven.context(function () {
      go();
    });
  } else {
    go();
  }

  function _traceKitFormatErrorStack(error) {
    if (!error) return null;
    if (typeof error.stack !== 'string') return null;
    error.stack = error.stack.split('\n').map(function (line) {
      return line.split(/ at\s+\//).join(' at (/');
    }).join('\n');
    return error;
  }

  window.onerror = function (msg, url, line, col, error) {
    if (process.env.HAIKU_RELEASE_ENVIRONMENT === 'production' || process.env.HAIKU_RELEASE_ENVIRONMENT === 'staging') {
      _traceKitFormatErrorStack(error);
      window.Raven.captureException(error);
    }
  };

  function go() {
    var electron = require('electron');
    var setup = require('./dom').default;
    electron.ipcRenderer.on('haiku', function (event, haiku) {
      return setup('creator', haiku);
    });
  }
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbnRyeS5qcyJdLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCIsIndpbmRvdyIsIlJhdmVuIiwiY29uZmlnIiwiZW52aXJvbm1lbnQiLCJyZWxlYXNlIiwiSEFJS1VfUkVMRUFTRV9WRVJTSU9OIiwiZGF0YUNhbGxiYWNrIiwiaW5zdGFsbCIsImNvbnRleHQiLCJnbyIsIl90cmFjZUtpdEZvcm1hdEVycm9yU3RhY2siLCJlcnJvciIsInN0YWNrIiwic3BsaXQiLCJtYXAiLCJsaW5lIiwiam9pbiIsIm9uZXJyb3IiLCJtc2ciLCJ1cmwiLCJjb2wiLCJjYXB0dXJlRXhjZXB0aW9uIiwiZWxlY3Ryb24iLCJyZXF1aXJlIiwic2V0dXAiLCJkZWZhdWx0IiwiaXBjUmVuZGVyZXIiLCJvbiIsImV2ZW50IiwiaGFpa3UiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUMsYUFBWTtBQUNYLE1BQUlBLFFBQVFDLEdBQVIsQ0FBWUMseUJBQVosS0FBMEMsWUFBMUMsSUFBMERGLFFBQVFDLEdBQVIsQ0FBWUMseUJBQVosS0FBMEMsU0FBeEcsRUFBbUg7QUFDakhDLFdBQU9DLEtBQVAsQ0FBYUMsTUFBYixDQUFvQiwyREFBcEIsRUFBaUY7QUFDL0VDLG1CQUFhTixRQUFRQyxHQUFSLENBQVlDLHlCQUFaLElBQXlDLGFBRHlCO0FBRS9FSyxlQUFTUCxRQUFRQyxHQUFSLENBQVlPLHFCQUYwRDtBQUcvRUM7QUFIK0UsS0FBakYsRUFJR0MsT0FKSDtBQUtBUCxXQUFPQyxLQUFQLENBQWFPLE9BQWIsQ0FBcUIsWUFBWTtBQUMvQkM7QUFDRCxLQUZEO0FBR0QsR0FURCxNQVNPO0FBQ0xBO0FBQ0Q7O0FBRUQsV0FBU0MseUJBQVQsQ0FBb0NDLEtBQXBDLEVBQTJDO0FBQ3pDLFFBQUksQ0FBQ0EsS0FBTCxFQUFZLE9BQU8sSUFBUDtBQUNaLFFBQUksT0FBT0EsTUFBTUMsS0FBYixLQUF1QixRQUEzQixFQUFxQyxPQUFPLElBQVA7QUFDckNELFVBQU1DLEtBQU4sR0FBY0QsTUFBTUMsS0FBTixDQUFZQyxLQUFaLENBQWtCLElBQWxCLEVBQXdCQyxHQUF4QixDQUE0QixVQUFDQyxJQUFELEVBQVU7QUFDbEQsYUFBT0EsS0FBS0YsS0FBTCxDQUFXLFVBQVgsRUFBdUJHLElBQXZCLENBQTRCLFFBQTVCLENBQVA7QUFDRCxLQUZhLEVBRVhBLElBRlcsQ0FFTixJQUZNLENBQWQ7QUFHQSxXQUFPTCxLQUFQO0FBQ0Q7O0FBRURYLFNBQU9pQixPQUFQLEdBQWlCLFVBQVVDLEdBQVYsRUFBZUMsR0FBZixFQUFvQkosSUFBcEIsRUFBMEJLLEdBQTFCLEVBQStCVCxLQUEvQixFQUFzQztBQUNyRCxRQUFJZCxRQUFRQyxHQUFSLENBQVlDLHlCQUFaLEtBQTBDLFlBQTFDLElBQTBERixRQUFRQyxHQUFSLENBQVlDLHlCQUFaLEtBQTBDLFNBQXhHLEVBQW1IO0FBQ2pIVyxnQ0FBMEJDLEtBQTFCO0FBQ0FYLGFBQU9DLEtBQVAsQ0FBYW9CLGdCQUFiLENBQThCVixLQUE5QjtBQUNEO0FBQ0YsR0FMRDs7QUFPQSxXQUFTRixFQUFULEdBQWU7QUFDYixRQUFJYSxXQUFXQyxRQUFRLFVBQVIsQ0FBZjtBQUNBLFFBQUlDLFFBQVFELFFBQVEsT0FBUixFQUFpQkUsT0FBN0I7QUFDQUgsYUFBU0ksV0FBVCxDQUFxQkMsRUFBckIsQ0FBd0IsT0FBeEIsRUFBaUMsVUFBQ0MsS0FBRCxFQUFRQyxLQUFSLEVBQWtCO0FBQ2pELGFBQU9MLE1BQU0sU0FBTixFQUFpQkssS0FBakIsQ0FBUDtBQUNELEtBRkQ7QUFHRDtBQUNGLENBckNBLEdBQUQiLCJmaWxlIjoiZW50cnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3NlbnRyeUNhbGxiYWNrfSBmcm9tICdoYWlrdS1zZXJpYWxpemF0aW9uL3NyYy91dGlscy9jYXJib25pdGUnXG5cbihmdW5jdGlvbiAoKSB7XG4gIGlmIChwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX0VOVklST05NRU5UID09PSAncHJvZHVjdGlvbicgfHwgcHJvY2Vzcy5lbnYuSEFJS1VfUkVMRUFTRV9FTlZJUk9OTUVOVCA9PT0gJ3N0YWdpbmcnKSB7XG4gICAgd2luZG93LlJhdmVuLmNvbmZpZygnaHR0cHM6Ly8wN2I3MDNjMTBlYTE0NjgxYTI5YTFhODcwYzI4ZTg0YUBzZW50cnkuaW8vMjI2MzgzJywge1xuICAgICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgfHwgJ2RldmVsb3BtZW50JyxcbiAgICAgIHJlbGVhc2U6IHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfVkVSU0lPTixcbiAgICAgIGRhdGFDYWxsYmFjazogc2VudHJ5Q2FsbGJhY2tcbiAgICB9KS5pbnN0YWxsKClcbiAgICB3aW5kb3cuUmF2ZW4uY29udGV4dChmdW5jdGlvbiAoKSB7XG4gICAgICBnbygpXG4gICAgfSlcbiAgfSBlbHNlIHtcbiAgICBnbygpXG4gIH1cblxuICBmdW5jdGlvbiBfdHJhY2VLaXRGb3JtYXRFcnJvclN0YWNrIChlcnJvcikge1xuICAgIGlmICghZXJyb3IpIHJldHVybiBudWxsXG4gICAgaWYgKHR5cGVvZiBlcnJvci5zdGFjayAhPT0gJ3N0cmluZycpIHJldHVybiBudWxsXG4gICAgZXJyb3Iuc3RhY2sgPSBlcnJvci5zdGFjay5zcGxpdCgnXFxuJykubWFwKChsaW5lKSA9PiB7XG4gICAgICByZXR1cm4gbGluZS5zcGxpdCgvIGF0XFxzK1xcLy8pLmpvaW4oJyBhdCAoLycpXG4gICAgfSkuam9pbignXFxuJylcbiAgICByZXR1cm4gZXJyb3JcbiAgfVxuXG4gIHdpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24gKG1zZywgdXJsLCBsaW5lLCBjb2wsIGVycm9yKSB7XG4gICAgaWYgKHByb2Nlc3MuZW52LkhBSUtVX1JFTEVBU0VfRU5WSVJPTk1FTlQgPT09ICdwcm9kdWN0aW9uJyB8fCBwcm9jZXNzLmVudi5IQUlLVV9SRUxFQVNFX0VOVklST05NRU5UID09PSAnc3RhZ2luZycpIHtcbiAgICAgIF90cmFjZUtpdEZvcm1hdEVycm9yU3RhY2soZXJyb3IpXG4gICAgICB3aW5kb3cuUmF2ZW4uY2FwdHVyZUV4Y2VwdGlvbihlcnJvcilcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnbyAoKSB7XG4gICAgdmFyIGVsZWN0cm9uID0gcmVxdWlyZSgnZWxlY3Ryb24nKVxuICAgIHZhciBzZXR1cCA9IHJlcXVpcmUoJy4vZG9tJykuZGVmYXVsdFxuICAgIGVsZWN0cm9uLmlwY1JlbmRlcmVyLm9uKCdoYWlrdScsIChldmVudCwgaGFpa3UpID0+IHtcbiAgICAgIHJldHVybiBzZXR1cCgnY3JlYXRvcicsIGhhaWt1KVxuICAgIH0pXG4gIH1cbn0oKSlcbiJdfQ==