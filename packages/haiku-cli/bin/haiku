#!/usr/bin/env node

var os = require('os')
var path = require('path')
var spawn = require('child_process').spawn
var platform = os.platform()
var root = (os.platform() === "win32") ? process.cwd().split(path.sep)[0] : '/'

function getHaikuAppPackagePath(platform) {
  switch (platform) {
    case 'darwin': return path.join(root, 'Applications', 'Haiku.app', 'Contents', 'MacOS', 'Haiku')
    case 'aix':  
    case 'freebsd':
    case 'linux':
    case 'openbsd':
    case 'sunos':
    case 'win32':
    default:
      throw new Error('Haiku does not yet support platform ' + platform)
  }
}

function spawnBin() {
  var bin = getHaikuAppPackagePath(platform)
  var argv = process.argv.slice(2)

  // If the subcommand is 'open', launch Creator instead of the CLI
  if (argv[0] === 'open') argv.shift()
  else process.env.HAIKU_APP_LAUNCH_CLI = '1'

  var args = ['--'].concat(argv) // Double-dash to forward args correctly
  spawn(bin, args, { stdio: 'inherit' })
}

spawnBin()
