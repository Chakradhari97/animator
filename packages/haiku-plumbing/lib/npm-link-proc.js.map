{"version":3,"sources":["../src/npm-link-proc.js"],"names":["npm","require","logger","argv","process","slice","shift","folder","linkees","info","env","HAIKU_SKIP_NPM_LINK","exit","load","loaded","loglevel","silent","quiet","progress","err","commands","link"],"mappings":";;AAAA,IAAIA,MAAMC,QAAQ,KAAR,CAAV;AACA,IAAIC,SAASD,QAAQ,8CAAR,CAAb;;AAEA,IAAIE,OAAOC,QAAQD,IAAR,CAAaE,KAAb,CAAmB,CAAnB,CAAX;AACAF,KAAKG,KAAL,G,CAAa;AACbH,KAAKG,KAAL,G,CAAa;AACb,IAAIC,SAASJ,KAAKG,KAAL,EAAb;AACA,IAAIE,UAAUL,IAAd;;AAEAD,OAAOO,IAAP,CAAY,wCAAZ,EAAsDF,MAAtD,EAA8D,aAA9D,EAA6EC,OAA7E;;AAEA,IAAIJ,QAAQM,GAAR,CAAYC,mBAAZ,KAAoC,GAAxC,EAA6C;AAC3CT,SAAOO,IAAP,CAAY,8CAAZ;AACAL,UAAQQ,IAAR;AACD;;AAED;AACA;AACA;;AAEAZ,IAAIa,IAAJ,CAAS,EAAEC,QAAQ,KAAV,EAAiBC,UAAU,QAA3B,EAAqCC,QAAQ,IAA7C,EAAmDC,OAAO,IAA1D,EAAgEC,UAAU,KAA1E,EAAT,EAA4F,UAAUC,GAAV,EAAe;AACzG,MAAIA,GAAJ,EAAS,MAAMA,GAAN;AACT,SAAOnB,IAAIoB,QAAJ,CAAaC,IAAb,CAAkBb,OAAlB,EAA2B,UAAUW,GAAV,EAAe;AAC/C,QAAIA,GAAJ,EAAS;AACPjB,aAAOO,IAAP,CAAY,6CAAZ;AACD;AACDL,YAAQQ,IAAR;AACD,GALM,CAAP;AAMD,CARD","file":"npm-link-proc.js","sourcesContent":["var npm = require('npm')\nvar logger = require('haiku-serialization/src/utils/LoggerInstance')\n\nvar argv = process.argv.slice(0)\nargv.shift() // node.js\nargv.shift() // this file\nvar folder = argv.shift()\nvar linkees = argv\n\nlogger.info('[master] npm link subprocess called in', folder, 'for linkees', linkees)\n\nif (process.env.HAIKU_SKIP_NPM_LINK === '1') {\n  logger.info('[master] env says to skip npm link; skipping')\n  process.exit()\n}\n\n// I think we have to set this to ensure the npm module installs in the right place\n// This is like the -g option or setting a cwd I think?\n// npm.prefix = folder\n\nnpm.load({ loaded: false, loglevel: 'silent', silent: true, quiet: true, progress: false }, function (err) {\n  if (err) throw err\n  return npm.commands.link(linkees, function (err) {\n    if (err) {\n      logger.info('[master] cannot npm link; proceeding anyway')\n    }\n    process.exit()\n  })\n})\n"]}