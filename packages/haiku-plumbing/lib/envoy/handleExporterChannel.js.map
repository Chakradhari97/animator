{"version":3,"sources":["../../src/envoy/handleExporterChannel.js"],"names":["exporterChannel","activeComponent","on","request","bytecodeSnapshot","fetchActiveBytecodeFile","getReifiedBytecode","reloadBytecodeFromDisk","err","contents","writeFile","filename","saved"],"mappings":";;;;;;AAAA;;;;AAEA;;AACA;;;;kBAEe,UAACA,eAAD,EAAkBC,eAAlB,EAAsC;AACnDD,kBAAgBE,EAAhB,uCAA+C,UAACC,OAAD,EAAa;AAC1D,QAAMC,mBAAmBH,gBAAgBI,uBAAhB,GAA0CC,kBAA1C,EAAzB;AACA;AACAL,oBAAgBM,sBAAhB,CAAuC,UAACC,GAAD,EAAS;AAC9C,UAAIA,GAAJ,EAAS;AACP,cAAMA,GAAN;AACD;;AAED,UAAMC,WAAW,0CAA0BN,OAA1B,EAAmCC,gBAAnC,CAAjB;AACA,mBAAGM,SAAH,CAAaP,QAAQQ,QAArB,EAA+BF,QAA/B,EAAyC,UAACD,GAAD,EAAS;AAChD,YAAIA,GAAJ,EAAS;AACP,gBAAMA,GAAN;AACD;;AAEDR,wBAAgBY,KAAhB,CAAsBT,OAAtB;AACD,OAND;AAOD,KAbD;AAcD,GAjBD;AAkBD,C","file":"handleExporterChannel.js","sourcesContent":["import fs from 'fs'\n\nimport { EXPORTER_CHANNEL } from 'haiku-sdk-creator/lib/exporter'\nimport { handleExporterSaveRequest } from 'haiku-formats/lib/exporters'\n\nexport default (exporterChannel, activeComponent) => {\n  exporterChannel.on(`${EXPORTER_CHANNEL}:save`, (request) => {\n    const bytecodeSnapshot = activeComponent.fetchActiveBytecodeFile().getReifiedBytecode()\n    // Re-mount the active component so mutations to the bytecode snapshot don't trickle into the project.\n    activeComponent.reloadBytecodeFromDisk((err) => {\n      if (err) {\n        throw err\n      }\n\n      const contents = handleExporterSaveRequest(request, bytecodeSnapshot)\n      fs.writeFile(request.filename, contents, (err) => {\n        if (err) {\n          throw err\n        }\n\n        exporterChannel.saved(request)\n      })\n    })\n  })\n}\n"]}